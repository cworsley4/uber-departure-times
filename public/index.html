<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Uber Coding Challenge - Departure Times</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" /> 
    <style type="text/css">
      html, body, #map-canvas {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <h2>Departure Times</h2>
    <div id="map-canvas"></div>

    <script type="text/javascript" src="/primus/primus.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWkOJErg5zPmd86G5Ag-Fa5n-QPOqKF9M"></script>
    <script type="text/javascript">
      (function (global, undefined) {
        function initialize (location, zoom) {
          zoom = zoom || 8;
          var mapOptions = {
            center: { lat: location.latitude, lng: location.longitude },
            zoom: zoom
          };
        
          window.gMap = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        }

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            initialize(position.coords, 13);
            var primus = Primus.connect();
            primus.on('open', function () {
              primus.send('register', {
                agency: 'sf-muni'
              });

              setTimeout(function () {
                primus.send('register:route', {
                  route: 67
                });
              }, 1000);
            });
          });
        } else {
          // IP Geolocation fallback
        }
      })(window);
    </script>
  </body>
</html>